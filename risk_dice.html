<html>
<script>

// (window.onload = function() {
//         roll_dice();


//     })();


// function dice() { return Math.floor((Math.random() * 10) + 1);};


//att def side를 꼬리변수로 만들어 1:1 이상의 개량의 여지를 준다.
// 테스트 함수 작성하여 값 확인
// console.assert

// 전투 종료시 후퇴 기능 추가



document.addEventListener('DOMContentLoaded', () => {

    const btn_bttl = document.querySelector('button');
    const prt_lst = document.querySelector('div');

    let att = document.getElementById('att');
    let def = document.getElementById('def');


    let att_trp = parseInt(att.value);
    let def_trp = parseInt(def.value);

    const prcs = ""; // 과정 로그 기록 += 형태  

    btn_bttl.addEventListener('click' , () => {

        battle1();
        
        prt_rslt();



    } );
});



function prt_rslt() {

    
    const winner = `공격측 부대 ${att_trp} 남음 수비측 부대 ${def_trp} 남음`;
    var prt_win = document.body.createElement('p');
    prt_win.textContent = winner;
    prt_lst.appendChild(prt_win); // 객채를 보유했는가 확인

};



function battle1() {

    var p1 = Array();
    p1 = gen_arr(3, att_trp); //파라미터 값을 받아서 처리
    var p2 = Array();
    p2 = gen_arr(2, def_trp);

    compare_dice(p1,p2);

}

function cllct_msg(p1r, p2r) {

    prcs += `공격측 주사위:${p1r} 수비측 주사위: ${p2r} <br />`;
}


function compare_dice(p1r,p2r) { //배열을 비교


    var bnum = 0;
    if (p1r.length < p2r.length) {
        bnum = p1r.length; 
    } else {
        bnum = p2r.length;
    }

    for (var i = 1; i <= bnum ; i++ ) {
        if ( p1r[i] > p2r[i] ) {
        def_trp -=1;
        } else {
        att_trp -=1;
        }


    }

    cllct_msg(p1r,p2r); 

};


function gen_arr(player, tpnum){
    var bet = num_dice(player, tpnum);
    var rslt = pdice(bet); // 인자는 횟수

    return rslt;
}


function num_dice(player, trpnum) { // player 는 3, 2 값만 받음

    var dicenum = 0;

    if (trpnum == 1 || trpnum == 2 ) {
        dicenum = trpnum;
    } else {
        dicenum = player;
    }

    return dicenum;
}


function pdice(nroll) { //재작성

    var rollset = Array();
    for (var i=1 ; i < nroll ; i++) {
        let roll = roll_dice();
        rollset.push(roll);
    }

    rollset.sort(function(a, b)  {
            if(a > b) return 1;
            if(a === b) return 0;
            if(a < b) return -1;
        });
    return rollset; // 배열

}; 



function roll_dice(){
    var rolldice = parseInt((Math.random() * 6) + 1);
    return rolldice; 
};

</script>
<body>
    <h1>Risk 주사위에 대한 설명</h1>
    <p width="800px">공격측은 3개의 주사위, 방어측은 2개의 주사위를 던지며 
        공격측과 방어측의 가장 높은 숫자의 주사위 2개를 
        각기 1등과 2등끼리 비교하여 
        공격측이 더 높다면 공격측의 승리, 
        숫자가 같거나 수비측이 더 높다면 수비측의 승리로 결정된다. 
        비교되는 숫자 1회당 군대(troop) 하나에 해당하며 
        군대가 1개 남아있다면 한개의 주사위를 던져야 한다.</p>

    <p>공격측과 수비측의 병력수를 입력하라.</p>
    <input id ="att" type="text">공격측</input><br/>
    <input id ="def" type="text">수비측</input><br/>
    <button>주사위를 굴린다</button><br/>

    <p>이하 전투의 과정과 결과</p>
    <div></div>
</body>
</html>