<html>
    <title> 한글 입력기 </title>
<script>
// '한'.charCodeAt(0).toString(16);
// String.fromCharCode(parseInt(unicode,16))
// String.fromCharCode(parseInt('\d55c',16));


// window.addEventListener("keydown", (event) => {
//   const p = document.createElement("p");
//   p.textContent = `KeyboardEvent: key='${event.key}' | code='${event.code}'`;
//   document.getElementById("output").appendChild(p);
//   window.scrollTo(0, document.body.scrollHeight);
// }, true);


var kcode = "";
var shift_on = false;
// 2차원 배열
var arr_sq = [];
// arr_sq 의 내부를 비교
var one_ltr = [];

// 배열로 처리 후 객체 생성
// var k_code = [
//     'Digit1', 'Digit2', 'Digit3', 'Digit4', 'Digit5', 'Digit6', 'Digit7', 'Digit8', 'Digit9', 'Digit0','Minus','Equal',
//      'KeyQ', 'KeyW', 'KeyE', 'KeyR', 'KeyT', 'KeyY', 'KeyU', 'KeyI', 'KeyO','KeyP', 'BracketLeft', 'BracketRight', 'Backslash',
//       'KeyA', 'KeyS', 'KeyD', 'KeyF', 'KeyG', 'KeyH', 'KeyJ', 'KeyK', 'KeyL', 'Semicolon', 'Quote',
//        'KeyZ', 'KeyX', 'KeyC', 'KeyV', 'KeyB', 'KeyN', 'KeyM', 'Comma', 'Period', 'Slash'
// ];

var k_code = [ 
    { keycode: 'Digit1', k_layval : 27, s_layval : 2, k_sq : 3, s_sq : 3 },
    { keycode: 'Digit2', k_layval : 20, s_layval : 9, k_sq : 3, s_sq : 3 },
    { keycode: 'Digit3', k_layval : 17, s_layval : 22, k_sq : 3, s_sq : 3 },
    { keycode: 'Digit4', k_layval : 12, s_layval : 14, k_sq : 2, s_sq : 2 },
    { keycode: 'Digit5', k_layval : 17, s_layval : 13, k_sq : 2, s_sq : 2 },
    { keycode: 'Digit6', k_layval : 2, s_layval : '\=', k_sq : 2, s_sq : 4 },
    { keycode: 'Digit7', k_layval : 7, s_layval : '“', k_sq : 2, s_sq : 4 },
    { keycode: 'Digit8', k_layval : 19, s_layval : '”', k_sq : 2, s_sq : 4 },
    { keycode: 'Digit9', k_layval : 13, s_layval : '\'', k_sq : 2, s_sq : 4 },
    { keycode: 'Digit0', k_layval : 15, s_layval : '\~', k_sq : 1, s_sq : 4 },
    { keycode: 'Minus', k_layval : '\)', s_layval : '\;', k_sq : 4, s_sq : 4 },
    { keycode: 'Equal', k_layval : '\>', s_layval : '\+', k_sq : 4, s_sq : 4 },

    { keycode: 'KeyQ', k_layval : 19, s_layval : 26, k_sq : 3, s_sq : 3 },
    { keycode: 'KeyW', k_layval : 8, s_layval : 25, k_sq : 3, s_sq : 3 },
    { keycode: 'KeyE', k_layval : 6, s_layval : 5, k_sq : 2, s_sq : 3 },
    { keycode: 'KeyR', k_layval : 1, s_layval : 15, k_sq : 2, s_sq : 3 },
    { keycode: 'KeyT', k_layval : 4, s_layval : 12, k_sq : 2, s_sq : 3 },
    { keycode: 'KeyY', k_layval : 5, s_layval : 5, k_sq : 1, s_sq : 4 },
    { keycode: 'KeyU', k_layval : 3, s_layval : 6, k_sq : 1, s_sq : 4 },
    { keycode: 'KeyI', k_layval : 6, s_layval : 7, k_sq : 1, s_sq : 4 },
    { keycode: 'KeyO', k_layval : 14, s_layval : 8, k_sq : 1, s_sq : 4 },
    { keycode: 'KeyP', k_layval : 17, s_layval : 9, k_sq : 1, s_sq : 4 },
    { keycode: 'BracketLeft', k_layval : '\(', s_layval : '\%', k_sq : 4, s_sq : 4 },
    { keycode: 'BracketRight', k_layval : '\<', s_layval : '\/', k_sq : 4, s_sq : 4 },
    { keycode: 'Backslash', k_layval : '\\', s_layval : '\|', k_sq : 4, s_sq : 4 },

    { keycode: 'KeyA', k_layval : 21, s_layval : 7, k_sq : 3, s_sq : 3 },
    { keycode: 'KeyS', k_layval : 4, s_layval : 6, k_sq : 3, s_sq : 3 },
    { keycode: 'KeyD', k_layval : 20, s_layval : 11, k_sq : 2, s_sq : 3 },
    { keycode: 'KeyF', k_layval : 0, s_layval : 10, k_sq : 2, s_sq : 3 },
    { keycode: 'KeyG', k_layval : 18, s_layval : 3, k_sq : 2, s_sq : 2 },
    { keycode: 'KeyH', k_layval : 2, s_layval : 0, k_sq : 1, s_sq : 4 },
    { keycode: 'KeyJ', k_layval : 11, s_layval : 1, k_sq : 1, s_sq : 4 },
    { keycode: 'KeyK', k_layval : 0, s_layval : 2, k_sq : 1, s_sq : 4 },
    { keycode: 'KeyL', k_layval : 12, s_layval : 3, k_sq : 1, s_sq : 4 },
    { keycode: 'Semicolon', k_layval : 7, s_layval : 4, k_sq : 1, s_sq : 4 },
    { keycode: 'Quote', k_layval : 16, s_layval : '·', k_sq : 1, s_sq : 4 },

    { keycode: 'KeyZ', k_layval : 16, s_layval : 23, k_sq : 3, s_sq : 3 },
    { keycode: 'KeyX', k_layval : 1, s_layval : 18, k_sq : 3, s_sq : 3 },
    { keycode: 'KeyC', k_layval : 5, s_layval : 24, k_sq : 2, s_sq : 3 },
    { keycode: 'KeyV', k_layval : 8, s_layval : 3, k_sq : 2, s_sq : 3 },
    { keycode: 'KeyB', k_layval : 13, s_layval : '\?', k_sq : 2, s_sq : 4 },
    { keycode: 'KeyN', k_layval : 9, s_layval : '\-', k_sq : 1, s_sq : 4 },
    { keycode: 'KeyM', k_layval : 18, s_layval : '\"', k_sq : 1, s_sq : 4 },
    { keycode: 'Comma', k_layval : '\,', s_layval : '\,', k_sq : 4, s_sq : 4 },
    { keycode: 'Period', k_layval : '\.', s_layval : '\.', k_sq : 4, s_sq : 4 },
    { keycode: 'Slash', k_layval : 8, s_layval : '\!', k_sq : 2, s_sq : 4 },

];

// var k_lout = [27, 20, 17, 12, 17, 2, 7, 19, 13, 15,
// 19, 8, 6, 1, 4, 5, 3, 6, 14, 17,
// 21, 4, 20, 0, 18, 2, 11, 0, 12, 7, 16,
// 16, 1, 5, 8, 13, 9, 18 ];

// var s_lout = [2, 9, 22, 14, 13, 
// 26, 25, 5, 15, 12, 
// 7, 6, 11, 10, 3, 
// 23, 18, 24, 3 ];



// vowel, consonant 처리 
    // const sq1 = [ 9, 18, 19, 20, 21, 22, 28, 29, 30, 31, 32, 33, 39,40 ];
    // const sq2 = [ 3, 4, 5, 6, 7, 8, 15, 16, 17, 25, 26, 27, 36, 37, 38 ];
    // const sq3 = [ 0, 1, 2, 13, 14, 23, 24, 34, 35 ];
// sq4 는 숫자나 특수문자

// const Digit1 = {

//     keycode : 'Digit1',
//     k_layval : 27, //
//     s_layval : 2,
//     k_sq : 3,
//     s_sq : 3
// };

// const Digit2 = {

//     keycode : 'Digit2',
//     k_layval : 20, //
//     s_layval : 9,
//     k_sq : 3,
//     s_sq : 3
// };

// const Digit3 = {

// keycode : 'Digit3',
// k_layval : 20, //
// s_layval : 9,
// k_sq : 3,
// s_sq : 3
// };


// var k_code = [
//     Digit1, Digit2, Digit3, Digit4, Digit5, Digit6, Digit7, Digit8, Digit9, Digit0, Minus, Equal,
//      KeyQ, KeyW, KeyE, KeyR, KeyT, KeyY, KeyU, KeyI, KeyO, KeyP, BracketLeft, BracketRight, Backslash,
//       KeyA, KeyS, KeyD, KeyF, KeyG, KeyH, KeyJ, KeyK, KeyL, Semicolon, Quote,
//        KeyZ, KeyX, KeyC, KeyV, KeyB, KeyN, KeyM, Comma, Period, Slash
// ];







document.addEventListener('DOMContentLoaded', () => { // 철자 확인 !!

    const kc_prt = document.querySelector('#kc_print'); // id 지정에 # 
    const ioarea = document.querySelector('#ioa');

    ioarea.addEventListener('keydown' , (event) => { // 키를 눌러 입력 시작

        // shift 키 down up 처리해야 한다.
        // alt, ctrl 은 구현할 필요없다.
        // kcode = event.keyCode; // 오류: 229 만 출력
        kcode = event.code;
        if ( kcode == 'ShiftLeft' || 'ShiftRight') { shift_on = true;}

        // k_code 목록에 있는 글자에만 코드값 배당
        if ( k_code.find( k => k.keycode === kcode ) ) {
            let c = one_snd(kcode); // 배열값 반환하는 함수의 배열을 받는다.
            proc_sq(c); // 전역변수(배열)에서 값을 받아서 처리
            
        }

        // 한글자 배열 c 를 받은 후
        // 일련의 입력값으로 연결하여 검사
        // 2차원배열
        // 일정입력후 글자코드로 변환 후 배열을 비워야한다.
        // 시퀀스 처리

        // 검사부
        // console.log(kcode);
        // console.log(shift_on);
        // console.log(typeof kcode); // string
        // console.log(event.code);
        // console.log(typeof event.code); //string
        

        // kc_prt.textContent += kcode; //"${kcode}" string type에 맞출것
        
        // 자모검사 flag
        // first consonant
        // sq 12 또는 123 순서대로 입력되었는가 
        // 키 눌림과 복귀를 따로 처리하여 중복눌림 방지하고

        // let keyobj = k_code.find(k => k.keycode === kcode );
        // 시퀀스 처리 배열에 push
        // 
        // input(keyobj); // 함수 따로 정의할것.

    });

    // shift 동시키 적용, 일반키 적용여부
    ioarea.addEventListener('keyup' , (event) => { 

        kcode = event.code;

        if (kcode == 'ShiftLeft' || 'ShiftRight') { shift_on = false;}

        // kc_prt.textContent += kcode; //"${kcode}" string type에 맞출것

        // console.log(k_lout.valueOf('KeyA')); //작동되지 않는다
        // console.log(k_lout.'KeyA');
        // console.log(kcode);
        // console.log(shift_on);
    });

    // kcode.addEventListener('change' , (event) => { 

    //     
    //     kc_prt.textContent += kcode; //"${kcode}" string type에 맞출것

    // });


}); // end domcontentloaded




// var lttr_first =
// k_code.find( k => k.sq === 1 );

// 배열연산 i++ sq 값 확인하면서 흐름제어, 분기함



// var obj = [
//     { name: 'Max', age: 23 },
//     { name: 'John', age: 20 },
//     { name: 'Caley', age: 18 }
// ];
 
// var found = obj.find(e => e.name === 'John');
// console.log(found);
 
// /*
//     결과: { name: 'John', age: 20 }
// */

// findIndex() idx 반환


// 키값에 해당하는 객체의 시퀀스를 확인하여 적합한 값을 초중종성에 배정하고 글자를 생성

// domcontentloaded 에 넣을지 결정해야 한다

function proc_sq(ltr) {


    
    if (ltr[2] == 1 || ltr[2] == 2 || ltr[2] == 3 ) { //전역 시퀀스 배열에 글자만 받음
        arr_sq.push[ltr];
        colsole.log(arr_sq); // 2차원배열값 확인할것
    }

    if ( kcode == 'Backspace' ) {  //현재 전역 kcode 값이 BS일때 마다 하나씩 지우기 splice
        arr_sq.splice( arr_sq.length - 1); //삭제할 요소 수를 지정하지 않아도 된다
    }



    for (let i = 0 ;  arr_sq[i][2] ; i++ ) {
        
        if (arr_sq[0][1] == 1 ) { 
            one_ltr.push( arr_sq[0][0] ); 
            //글자 하나마다 계산하여 출력해줘야 한다.
            //
        }

        if (arr_sq[0][2] == 1  && arr_sq[1][2] == 1 ) { 
            one_ltr.splice(0,1); //초성 지우고 쌍자음으로 재입력 받을 준비
            one_ltr.push( arr_sq[1][0] + 1 );
        } // 쌍자음 처리

        if (arr_sq[i][1] == 2 && arr_sq[i - 1][1] == 1) { one_ltr.push( arr_sq[i][0] ); } // 모음 다음에 종성이 있는가 판단 

        if (arr_sq[i][1] == 2 && arr_sq[i-1][1] == 2 ) {
            if( arr_sq[i-1][0] == 8 ) { // ㅗ ㅜ 처리부
                if (arr_sq[i][0] == 0 ) { 
                    one_ltr.splice(1,1);
                    one_ltr.push(9); 
                } //ㅘ
                if (arr_sq[i][0] == 1 ) {
                    one_ltr.splice(1,1);
                    one_ltr.push(10); 
                } // ㅙ
                if (arr_sq[i][0] == 20 ) {
                    one_ltr.splice(1,1);
                    one_ltr.push(11); 
                } // ㅚ

            }
            if( arr_sq[i-1][0] == 13 ) {

                if (arr_sq[i][0] == 4 ) { 
                    one_ltr.splice(1,1);
                    one_ltr.push(14); 
                } //ㅝ
                if (arr_sq[i][0] == 5 ) { 
                    one_ltr.splice(1,1);
                    one_ltr.push(15); 
                } //ㅞ
                if (arr_sq[i][0] == 20 ) { 
                    one_ltr.splice(1,1);
                    one_ltr.push(16); 
                } //ㅟ
            }
        } // 이중모음 처리

        //글자 출력 및 이전 시퀀스배열 정리

        if (arr_sq[i][1] == 1 && arr_sq[i-1][1] == 2 ) { // 앞은 중성이고 현재입력은 초성인 경우 

            let last_val = arr_sq[i] ; //배열로 저장되어야 한다.
             
            // 추가하여 계속 입력하도록 처리해야 한다. 
            // 배열을 완전히 비우면 첫키 입력값을 잃는다
            arr_sq = [];
            arr_sq.push(last_val); // 초성은 입력값으로 보전한다.
            // 전역변수로 돌린 one_ltr 은 리턴값이 될수없다.

            // 전역변수 one_ltr 처리하는 함수 호출하고 값 비우게 할것.

        } // 받침 없는 글자 처리 

        if (arr_sq[i][1] == 3 ) {} // 이전값이 모음

        // if (arr_sq[1][2] == 1 ) {}
        //else if (arr_sq[1][2] == 1 ) {}

        else {}
    }

    arr_sq = [];
    return one_ltr; //글자 하나의 배열 
};

function one_snd(kc) {

    let val = k_code.find( k => k.keycode === kc ); // 코드를 찾는다 
    let snd = 0;
    let sq = 0;
    let cha = [];

    if (shift_on) {
        snd = val.s_layval;
        sq = val.s_sq;
    } else {
        snd = val.k_layval;
        sq = val.k_sq;
    }

    console.log(shift_on);
    console.log(snd);
    console.log(sq);

    cha.push( snd , sq ); // 개별 키값과 시퀀스값을 구성


    console.log(cha);

    return cha;
};


// 모음 입력을 받을때까지 자음수를 셀것 v_count c_count
// sq 는 넘겨받은 배열 2번째 값

// 매개변수 배열
function iput(ltr) {

    // space, enter sq 3, 4 등 sq 1, 2, 아닌값 들어오면 입력을 마친다.

    // if (ltr[1] == 1 || ltr[1] == 2 )
    // for( let i = 0 ) {}
    // push
    // 입력 받을때마다 글자 표시하고
    // 글자 바뀔때마다 새로 표시

    let hcde = 0;

    // one_ltr[0] * 588
    // one_ltr[1] * 28
    // one_ltr[2] *
    // + 44032

    // rslt_str = &#code_val;
};



</script>

<body>
    <p id="kc_print">keycode input result : </p>
    <textarea name="input_area" id="ioa" cols="30" rows="10"></textarea>

</body>
</html>