<html>
<script>

// (window.onload = function() {
//         roll_dice();


//     })();


// function dice() { return Math.floor((Math.random() * 10) + 1);};


//att def side를 꼬리변수로 만들어 1:1 이상의 개량의 여지를 준다.
// 테스트 함수 작성하여 값 확인
// console.assert

// 전투 종료시 후퇴 기능 추가



document.addEventListener('DOMContentLoaded', () => {

    const btn_bttl = document.querySelector('button');
    const prt_lst = document.querySelector('div');

    let att = document.getElementById('att');
    let def = document.getElementById('def');


    let att_trp = att.value;
    let def_trp = def.value;

    btn_bttl.addEventListener('click' , battle() );
});


// class Player {
//     constructor () {

//     }
// };

function prt_rec( attf , deff) {
    var att_roll_rslt = attf;
    var def_roll_rslt = deff;

    var att_remained = att_trp;
    var def_remained = def_trp;

    var result = `공격 주사위 ${att_roll_rslt} 방어 주사위 ${def_roll_rslt} 
    공격자 남은 군대 ${att_trp} 방어자 남은 군대 ${def_trp}`; 

    const brec = document.createElement('p');
    brec.textContent = result;
    prt_lst.appendChild(brec);

    // hdr.setAttribute('id' , "header-idx");
    // document.body.appendChild(hdr);

    // const dv_hdr = document.createElement('div');
    //         dv_hdr.setAttribute('class' , "navitem");
    //         hdr.appendChild(dv_hdr);

    //         const hd = document.createElement('a');
            
    //         hd.textContent = idxList[i];
    //         hd.setAttribute('href' , purl[i]);
    //         hd.setAttribute('class' , "lstitem");

    //         dv_hdr.appendChild(hd);
};



function prt_rslt() {

    if (att_trp > def_trp ) {

        const winner = `공격측 부대 ${att_trp} 남음 수비측 부대 ${def_trp} 남음`;

    } else {
        const winner = `공격측 부대 ${att_trp} 남음 수비측 부대 ${def_trp} 남음`;
    }

        
        var prt_win = document.body.createElement('p');
        prt_win.textContent = winner;
        prt_lst.appendChild(prt_win);


};


function battle() {

    while ( (att_trp = 0) || (def_trp = 0) ) {
        compare_dice();
        // probe_reteat();
    }

    prt_rslt();
    
}

// function probe_reteat() {

    

//     var prb = document.createElement('p');
//     prb.textContent = "후퇴하시겠습니까?";

//     const button = document.createElement('button');
//     prt_lst.appendChild(prt_win);
 
//     // 키입력으로 space
//     var answer = addEventListener();

//     if 
    
// }

function compare_dice() {

    let att_fire = collect_dice(att_trp, 3);
    let def_fire = collect_dice(def_trp, 2);


    if ( (att_fire.lenth = 1) || (def_fire.length = 1) ) {
        if (att_fire[0] > def_fire[0]) {
         def_trp -= 1;
        }else{
         att_trp -= 1;
        };
        
    } else {

        if (att_fire[0] > def_fire[0]) {
         def_trp -= 1;
        }else{
         att_trp -= 1;
        };

    
        if (att_fire[1] > def_fire[1]) {
         def_trp -= 1;
        }else{
         att_trp -= 1;
        };
        
    };

    prt_rec( att_fire , def_fire, );
};

function collect_dice(trp , proll) {

    let rollnum = proll;
    let remmained = trp; 
    let rollset = Array();

    if (remained < 3) rollnum = remained; 

    //roll
    for(var i=0; i=rollnum ; i++) {
        rollset[i] = roll_dice();
    }

    let argd_dice = arrange_dice(rollset);
    return argd_dice;

}; 

function arrange_dice( roll_rec ) {
   
    var rollset = rollrec;
    if(rollset !== 1) {
        rollset.sort(function(a, b)  {
            if(a > b) return 1;
            if(a === b) return 0;
            if(a < b) return -1;
            });
        } //end if

    return rollset;

};


function roll_dice(){
        
        
    //document.write(parseInt( Math.random() * (10 - 1) ) + 1);
        var rolldice = parseInt((Math.random() * 6) + 1);


        return rolldice; 
};

</script>
<body>
    <h1>Risk 주사위에 대한 설명</h1>
    <p width="800px">공격측은 3개의 주사위, 방어측은 2개의 주사위를 던지며 
        공격측과 방어측의 가장 높은 숫자의 주사위 2개를 
        각기 1등과 2등끼리 비교하여 
        공격측이 더 높다면 공격측의 승리, 
        숫자가 같거나 수비측이 더 높다면 수비측의 승리로 결정된다. 
        비교되는 숫자 1회당 군대(troop) 하나에 해당하며 
        군대가 1개 남아있다면 한개의 주사위를 던져야 한다.</p>

    <p>공격측과 수비측의 병력수를 입력하라.</p>
    <input id ="att" type="text">공격측</input><br/>
    <input id ="def" type="text">수비측</input><br/>
    <button>주사위를 굴린다</button><br/>

    <p>이하 전투의 과정과 결과</p>
    <div></div>
</body>
</html>